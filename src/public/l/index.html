<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Br3f - Anonymous One-time URL Redirects</title>
    <meta
      name="description"
      content="Leave no trace. Create disguised, one-time redirect
        links to use whenever you have to share a sensitive URL in a chat or
        email."
    />
  </head>

  <script type="module">
    import { retrieveSecret } from 'https://cdn.skypack.dev/scrt-link-core'

    const hashData = window.location.hash.substring(1).split('/')
    const alias = hashData[0]
    const decryptionKey = hashData[1]

    const redirectWithDelay = () => {
      const br = document.createElement('br')
      document.body.appendChild(br)
      document.body.append('You will be redirected in a second.')

      setTimeout(() => {
        window.location.replace('https://br3f.com')
      }, 3000)
    }

    document.body.innerText = 'Redirectâ€¦'

    if (!alias || typeof alias !== 'string') {
      document.body.innerText = 'Invalid alias.'
      redirectWithDelay()
      throw new Error('Invalid alias.')
    }
    if (!decryptionKey) {
      document.body.innerText = 'Decryption key missing.'
      redirectWithDelay()
      throw new Error('Decryption key missing.')
    }

    const secret = await retrieveSecret(alias, decryptionKey).catch((error) => {
      document.body.innerText = error?.message || 'Something went wrong.'

      redirectWithDelay()
    })

    secret?.message && window.location.replace(secret.message)
  </script>
</html>
